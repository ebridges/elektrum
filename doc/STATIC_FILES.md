# Publishing Changes to Static Files

This application considers JS, CSS, and image files to be static assets.

The application looks for static assets in `application/static`.

When a change is made to any static assets, then they need to be copied up to the static asset bucket (configured via environment variable `STATIC_FILES_BUCKET_NAME`) on S3 where they get accessed via the CDN.

Publishing static assets is done by running the command:

```
$ cd application && python manage.py collectstatic
```

## Javascript Files

### About

There are two git submodules that this product uses:
* [`javascript-load-image`](https://github.com/blueimp/JavaScript-Load-Image) This is a tool for rendering images with Javascript.  It is used to fit an image into the viewport of the viewing device.  It is used in the method `renderImage` in `/js/media_item.js` which, in turn, is called to render the single image view in `media_item_view.html`.
* [`view-s3-dropzone`](https://github.com/kfei/vue-s3-dropzone) This is a tool that exposes a "dropzone" to upload photos to S3 using pre-signed URLs generated by Elektrum.  It is used from `media_item_upload_view.html`.

### Building

If changes are added to the JS libs, then they can be built and added to the project by using the Makefile in the `application` subdirectory:

```
$ make static
```

This will copy `load-image.all.min.js` for JS Load Image into `application/static/js` where the application will look for it.

As well, it will run yarn and bundle up `app.js`, `vendor.js`, `manifest.js` and `app.css`, then copy those over (along with source maps) to `application/static/js`.

### Publishing

After running `make static` and if any files are changed under `application/static/js` (typically as a result of changes that were done in the originating libs), then these changes need to be added to the commit history of Elektrum.

```
$ git diff-index --exit-code --name-only HEAD -- application/static
## ... should list out changed files in `static`
$ git add ./css/app* ./js/app* ./js/manifest* ./js/vendor* ./js/load-image*
$ git commit --gpg-sign --message "chore: static assets generated."
```
